---
title: "AGOL & Pro"
output: github_document
---

```{r setup, include=FALSE}
# Document options
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
```

## AGOL logistic service & ArcGIS Pro

I've added a feature layer on Portal of isochrones I created using ArcGIS Pro and the AGOL logistic service.There are some very rough notes on what I did in the [TakeawaysDataAndApp.docx](https://1drv.ms/w/s!AhGALyAD2g76ibwuUw9xeggd29iV4g?e=Coiglw) under "Appendix i) Breadcrumbs - School Isochrones".  

```{r agol-pro, fig.height = 5}
# URL for secondary school isochrones from the Council's Portal (with a token!)
isochrones_url  <- str_c(
  "https://sheffieldcitycouncil.cloud.esriuk.com/server/rest/services/Hosted/",
  "Secondary_school_400m_isochrome/FeatureServer/0?token=SCuzHcThaOEkh6ewOOmp",
  "NYTOa9AckubYSesbQEF9RRM5jM5ruaWfCAkS7hRSJvwBpDtBhJbiCB_eFZH-REj9z1Tu7jOGF2",
  "-atu5AgJGrPMwm8v_VR96qjHySeRHp2hSNGXQ9pAWAu6QCTsOitAIgs_fJD5pZVw4fwxXSg0es",
  "pjtFC0l1tSnExQ2tFyA3UR5zArYLZDV_8DrwMySPs4_0rzwWR4gShptQqPErbwkY078.")

# Get secondary school isochrones as simple features with WSG84 coordinates
sf_isochrones <- arc.open(isochrones_url) %>% 
  arc.select() %>% 
  arc.data2sf() %>% 
  st_transform(crs = 4326)

# Plot
ggmap(shef_basemap) +
  geom_sf(data = sf_isochrones, mapping = aes(),
          colour = "blue", inherit.aes = FALSE) +
  geom_sf(data = sf_secondary_schools, mapping = aes(),
          colour = "blue", size = 0.5, inherit.aes = FALSE) +
  geom_sf(data = sf_city_boundary, mapping = aes(), 
          fill = NA, colour = "brown", size = 1, inherit.aes = FALSE) +
  ggtitle("Sheffield Secondary School 400m Iscochrones") +
  theme_void()
```

Focusing on the isochrone for our example, Sheffield Park Academy:

```{r agol-pro-park, fig.height = 8}
# Get a subset of just Sheffield Park Academy isochrone as a simple feature
sf_park_isochrone <- filter(sf_isochrones, facilityid == 28)

# Plot
ggmap(park_basemap, extent = "device") +
  geom_sf(data = sf_park_isochrone, mapping = aes(),
          colour = "blue", size = 1.5, fill = NA, inherit.aes = FALSE) +
  geom_sf(data = sf_park, mapping = aes(),
          colour = "blue", size = 4, inherit.aes = FALSE) +
  ggtitle("Sheffield Park Academy 400m Isochrone") +
  theme_void()
```

The roundabout on Prince of Wales Road has a walkway that goes underneath it but above the Parkway. The AGOL location service hasn't included this walkway, so the isochrone stops incorrectly short of the Parkway. 

## openrouteservice & R

The [openrouteservice R client package](https://giscience.github.io/openrouteservice-r/index.html) provides easy access to the [openrouteservice](https://openrouteservice.org/) (ORS) API from R.

## OSMM Highways Network & Portal

*TODO: get OneNote isochrone notes*

## OSMM Highways Network & ArcGIS Pro

## Other options

*TODO: see takeaway bookmarks and in particular the Lovelace paper*

# Appendix

## ToDo

-   Left column navigation (try [includes: in_header:](https://rmarkdown.rstudio.com/github_document_format.html#Figure_Options))

-   Separate documents

## GitHub Documents

This is an R Markdown format used for publishing markdown documents to GitHub. When you click the **Knit** button all R code chunks are run and a markdown file (.md) suitable for publishing to GitHub is generated.

Unlike the [Notes](https://scc-pi.github.io/notes/) site, the bulk of the rendering is done locally rather than via GitHub Actions. To some extent this is simpler, and it also works around where rendering needs to reference a local licensed installation of ArcGIS desktop. The site is setup as per the basic [GitHub Pages guidance](https://guides.github.com/features/pages). The rendering that isn't local uses a [Jekyll theme](https://docs.github.com/en/pages/setting-up-a-github-pages-site-with-jekyll/adding-a-theme-to-your-github-pages-site-using-jekyll).
